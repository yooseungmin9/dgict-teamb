<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>오늘의 경제 뉴스</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" href="/css/footer.css"/>
  <link rel="stylesheet" href="/css/header.css"/>

  <style>
    /* ===== 뉴스 카드 ===== */
    #news-page .news-list{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:16px}
    #news-page .news-card{border:1px solid #e5e7eb;border-radius:14px;background:#fff;padding:16px;display:flex;gap:16px;align-items:flex-start;transition:box-shadow .18s}
    #news-page .news-card:hover{box-shadow:0 8px 24px rgba(0,0,0,.06)}
    #news-page .news-thumb{width:180px;height:120px;object-fit:cover;border-radius:10px;flex:0 0 180px;background:#f3f4f6}
    #news-page .news-body{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}
    #news-page .news-title{font-weight:800;font-size:18px;color:#111827}
    #news-page .news-meta{font-size:12px;color:#6b7280}
    #news-page .summary-wrap{position:relative;flex:1;min-height:64px}
    #news-page .news-summary{--lines:3;display:-webkit-box;-webkit-line-clamp:var(--lines);-webkit-box-orient:vertical;overflow:hidden;color:#374151;line-height:1.6;margin:0;padding-right:60px}
    #news-page .news-card[data-expanded="true"] .news-summary{-webkit-line-clamp:unset;overflow:visible}
    #news-page .more-toggle{position:absolute;bottom:0;right:0;border:none;background:linear-gradient(to right,rgba(255,255,255,0),#fff 40%);color:#2563eb;font-size:13px;padding:0 4px;cursor:pointer;display:none}
    #news-page .more-toggle:hover{text-decoration:underline}
    #news-page .pagination{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:20px}
    #news-page .page-btn{border:1px solid #e5e7eb;border-radius:6px;padding:6px 12px;background:#fff;color:#000000;font-size:14px;text-decoration:none;transition:.15s}
    #news-page .page-btn:hover{background:#2563eb;color:#fff}
    #news-page .page-info{font-size:14px;color:#6b7280}
    @media (max-width:640px){#news-page .news-thumb{width:140px;height:100px}#news-page .news-title{font-size:16px}}

    /* ===== 전일 브리핑 ===== */
    .news-section h3{margin:28px auto 14px;max-width:980px;font-weight:800;color:#000000;letter-spacing:-.2px}
    .briefing-wrap{max-width:980px;margin:0 auto 28px}
    .briefing-date{margin:0 0 12px;font-size:13px;color:#6b7a91;padding-left:6px;border-left:3px solid #cfe2ff}
    .briefing-list{display:flex;flex-direction:column;gap:14px}
    .briefing-item{display:flex;gap:14px;align-items:flex-start;background:#fff;border:1px solid #e6eef8;border-radius:14px;padding:16px;box-shadow:0 6px 16px rgba(31,58,105,.06);transition:box-shadow .15s,transform .15s}
    .briefing-item:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(31,58,105,.08)}
    .briefing-bar{width:6px;align-self:stretch;border-radius:8px;background:#6ea8fe}
    .briefing-body{flex:1;min-width:0;display:flex;flex-direction:column;gap:8px}
    .briefing-title{display:flex;align-items:center;gap:8px;margin:0;font-weight:800;color:#16325c}
    .cat-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#eef5ff;color:#1f4fb7;border:1px solid #d7e6ff;font-size:13px}
    .cat-chip .dot{width:8px;height:8px;border-radius:50%;background:#4c84ff;box-shadow:0 0 0 2px rgba(76,132,255,.15) inset}
    .briefing-summary{margin:0;color:#233549;line-height:1.7}
    .briefing-tags{display:flex;flex-wrap:wrap;gap:8px}
    .briefing-tags .tag{font-size:12px;color:#000000;background:#f4f8ff;border:1px solid #dfe9ff;padding:6px 10px;border-radius:999px}
  </style>

  <!-- 순서 중요: 봉인 → 페이지 스크립트 -->
  <script defer src="/js/briefing-once.js"></script>
  <script defer src="/js/news.js"></script>
</head>

<body>
  <div th:replace="fragments/header :: siteHeader"></div>

  <main class="main">
    <div class="container">
      <!-- 🔧 전일 브리핑 API 서버 주소 -->
      <div id="news-page" class="page" data-api-base="http://127.0.0.1:8005">
        <h2 class="page-title" style="text-align:center">오늘의 경제 뉴스</h2>

        <!-- 뉴스 리스트 -->
        <div class="news-section">
          <h3>금일 주요 뉴스</h3>
          <div id="news-list" class="news-list">
            <div class="news-card" th:each="it : ${items}" th:attr="data-id=${it.id}" tabindex="0">
              <img class="news-thumb" th:src="${it.image} ?: @{/img/placeholder-120x80.png}" th:alt="${it.title}" />
              <div class="news-body">
                <span class="news-title" th:text="${it.title}">제목</span>
                <div class="news-meta" th:text="${it.publishedAt != null} ? ${#temporals.format(it.publishedAt, 'yyyy-MM-dd HH:mm')} : ''"></div>
                <div class="summary-wrap">
                  <p class="news-summary" th:text="${it.summary}">요약</p>
                  <button type="button" class="more-toggle">더 보기</button>
                </div>
              </div>
            </div>
            <p class="muted" th:if="${#lists.isEmpty(items)}">표시할 뉴스가 없습니다.</p>
          </div>

          <div id="pagination" class="pagination">
            <a class="page-btn" th:if="${hasPrev}" th:href="@{/pages/news(page=${page - 1}, size=${size})}">이전</a>
            <span class="page-info" th:text="${page} + ' 페이지'">1 페이지</span>
            <a class="page-btn" th:if="${hasNext}" th:href="@{/pages/news(page=${page + 1}, size=${size})}">다음</a>
          </div>
        </div>

        <!-- 전일 브리핑 -->
        <div class="news-section">
          <h3>전일 브리핑 요약</h3>
          <div class="briefing-wrap">
            <p class="briefing-date">불러오는 중…</p>
            <div class="briefing-list" id="briefing-list"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 상세 모달 -->
  <div id="news-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <button type="button" class="modal-close" aria-label="닫기">×</button>
      <div class="modal-header">
        <h3 id="modal-title" class="modal-title"></h3>
        <div class="modal-meta"><span id="modal-updated" class="meta-date"></span></div>
      </div>
      <div class="modal-body">
        <img id="modal-image" class="modal-image" alt="article image" style="display:none;" />
        <div class="modal-content"><p id="modal-content"></p></div>
      </div>
      <div class="modal-footer">
        <a id="modal-link" class="btn" href="#" target="_blank" rel="noopener noreferrer">원문 링크</a>
        <span id="modal-press" class="meta-press"></span>
      </div>
    </div>
  </div>

  <div th:replace="fragments/footer :: siteFooter"></div>
</body>
</html>
