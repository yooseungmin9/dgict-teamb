<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ì˜ ê²½ì œ ë‰´ìŠ¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" th:href="@{/css/style.css}" />

  <!-- â–¼â–¼â–¼ ìˆ˜ì •ëœ ë¶€ë¶„ í¬í•¨ CSS â–¼â–¼â–¼ -->
  <style>
    /* ===== ìŠ¤ì½”í”„: ì´ í˜ì´ì§€ ì•ˆì—ì„œë§Œ ë™ì‘ ===== */
    #news-page .news-list{
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #news-page .news-card{
      border:1px solid #e5e7eb; border-radius:14px; background:#fff;
      padding:16px;
      display:flex; gap:16px; align-items:flex-start;
      transition:box-shadow .18s;
    }
    #news-page .news-card:hover{ box-shadow:0 8px 24px rgba(0,0,0,.06); }

    #news-page .news-thumb{
      width: 180px; height: 120px; object-fit:cover; border-radius:10px; flex:0 0 180px;
      background:#f3f4f6;
    }

    #news-page .news-body{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    #news-page .news-title{ font-weight:800; font-size:18px; color:#111827; }
    #news-page .news-meta{ font-size:12px; color:#6b7280; }

    /* âœ… ìš”ì•½ ë°•ìŠ¤ ìˆ˜ì • */
    #news-page .summary-wrap{
      position: relative;
      flex: 1;
      min-height: 64px;
    }

    #news-page .news-summary{
      --lines: 3;
      display: -webkit-box;
      -webkit-line-clamp: var(--lines);
      -webkit-box-orient: vertical;
      overflow: hidden;
      color:#374151;
      line-height:1.6;
      margin:0;
      padding-right:60px; /* ë²„íŠ¼ ê³µê°„ í™•ë³´ */
      position:relative;
    }

    #news-page .news-card[data-expanded="true"] .news-summary{
      -webkit-line-clamp: unset;
      overflow: visible;
      /* âœ… padding-right ìœ ì§€ â†’ í­ ë™ì¼ */
      padding-right:60px;
    }

    /* âœ… ë²„íŠ¼ì„ ë¬¸ë‹¨ ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ ê³ ì • */
    #news-page .more-toggle{
      position:absolute;
      bottom:0;
      right:0;
      border:none;
      background:linear-gradient(to right, rgba(255,255,255,0), #fff 40%);
      color:#2563eb;
      font-size:13px;
      padding:0 4px;
      cursor:pointer;
      line-height:1.6;
    }
    #news-page .more-toggle:hover{ text-decoration:underline; }

    #news-page .pagination {
      display: flex;
      justify-content: center;   /* ê°€ë¡œ ê°€ìš´ë° ì •ë ¬ */
      align-items: center;       /* ì„¸ë¡œ ê°€ìš´ë° ë§ì¶¤ */
      gap: 12px;                 /* ë²„íŠ¼ ê°„ê²© */
      margin-top: 20px;
      text-align: center;
    }

    #news-page .page-btn {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 6px 12px;
      background: #fff;
      color: #111827;
      font-size: 14px;
      text-decoration: none;
      transition: all 0.15s ease;
    }

    #news-page .page-btn:hover {
      background: #2563eb;
      color: #fff;
    }

    #news-page .page-info {
      font-size: 14px;
      color: #6b7280;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width:640px){
      #news-page .news-thumb{ width:140px; height:100px; flex-basis:140px; }
      #news-page .news-title{ font-size:16px; }
    }
  </style>
</head>

<body>
<div th:replace="fragments/header :: siteHeader"></div>

<main class="main">
  <div class="container">
    <div id="news-page" class="page">
      <h2 class="page-title" style="text-align:center">ì˜¤ëŠ˜ì˜ ê²½ì œ ë‰´ìŠ¤</h2>

      <div class="news-section">
        <h3>ê¸ˆì¼ ì£¼ìš” ë‰´ìŠ¤</h3>

        <div id="news-list" class="news-list">
          <div class="news-card"
               th:each="it : ${items}"
               th:attr="data-id=${it.id}"
               tabindex="0">

            <img class="news-thumb"
                 th:src="${it.image} ?: @{/img/placeholder-120x80.png}"
                 th:alt="${it.title}" />

            <div class="news-body">
              <span class="news-title" th:text="${it.title}">ì œëª©</span>
              <div class="news-meta"
                   th:text="${it.publishedAt != null} ? ${#temporals.format(it.publishedAt, 'yyyy-MM-dd HH:mm')} : ''">
              </div>

              <!-- âœ… ìˆ˜ì •ëœ ë¶€ë¶„ -->
              <div class="summary-wrap">
                <p class="news-summary" th:text="${it.summary}">ìš”ì•½</p>
                <button type="button" class="more-toggle">ë” ë³´ê¸°</button>
              </div>
            </div>
          </div>

          <p class="muted" th:if="${#lists.isEmpty(items)}">í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <div id="pagination" class="pagination">
          <a class="page-btn"
             th:if="${hasPrev}"
             th:href="@{/pages/news(page=${page - 1}, size=${size})}">ì´ì „</a>
          <span class="page-info" th:text="${page} + ' í˜ì´ì§€'">1 í˜ì´ì§€</span>
          <a class="page-btn"
             th:if="${hasNext}"
             th:href="@{/pages/news(page=${page + 1}, size=${size})}">ë‹¤ìŒ</a>
        </div>
      </div>

      <div class="news-section">
        <h3>ì „ì¼ ë¸Œë¦¬í•‘ ìš”ì•½</h3>
        <div class="briefing-card border rounded p-3 mt-4">
          <div class="briefing-content">
            <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ìƒì„¸ ëª¨ë‹¬ -->
<div id="news-modal" class="modal" aria-hidden="true">
  <div class="modal-backdrop"></div>
  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <button type="button" class="modal-close" aria-label="ë‹«ê¸°">Ã—</button>
    <div class="modal-header">
      <h3 id="modal-title" class="modal-title"></h3>
      <div class="modal-meta">
        <span id="modal-updated" class="meta-date"></span>
      </div>
    </div>
    <div class="modal-body">
      <img id="modal-image" class="modal-image" alt="article image" style="display:none;" />
      <div class="modal-content">
        <p id="modal-content"></p>
      </div>
    </div>
    <div class="modal-footer">
      <a id="modal-link" class="btn" href="#" target="_blank" rel="noopener noreferrer">ì›ë¬¸ ë§í¬</a>
      <span id="modal-press" class="meta-press"></span>
    </div>
  </div>
</div>

<script th:src="@{/js/app.js}" defer></script>

<script>
  (function () {
    const modal = document.getElementById('news-modal');
    const closeBtn = modal.querySelector('.modal-close');
    const backdrop = modal.querySelector('.modal-backdrop');
    const $mTitle   = document.getElementById('modal-title');
    const $mUpdated = document.getElementById('modal-updated');
    const $mImg     = document.getElementById('modal-image');
    const $mContent = document.getElementById('modal-content');
    const $mLink    = document.getElementById('modal-link');
    const $mPress   = document.getElementById('modal-press');

    function lockScroll(lock){ document.documentElement.style.overflow = document.body.style.overflow = lock ? 'hidden' : ''; }
    function showModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); lockScroll(true); }
    function hideModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); lockScroll(false); }

    closeBtn.addEventListener('click', hideModal);
    backdrop.addEventListener('click', hideModal);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') hideModal(); });

    async function openModalById(id){
      try{
        const res = await fetch(`/pages/news/${encodeURIComponent(id)}`);
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();

        $mTitle.textContent = data.title || '(ì œëª© ì—†ìŒ)';
        const updated = data.updated_at || data.publishedAt || data.published_at;
        $mUpdated.textContent = updated ? String(updated).substring(0,10) : '';

        if(data.image){
          $mImg.src = data.image;
          $mImg.alt = data.title || 'article image';
          $mImg.style.display = 'block';
          $mImg.onerror = () => { $mImg.style.display = 'none'; };
        } else {
          $mImg.removeAttribute('src');
          $mImg.style.display = 'none';
        }

        $mContent.textContent = data.content || data.summary || '';
        if(data.url){ $mLink.href = data.url; $mLink.style.display = 'inline-block'; }
        else { $mLink.removeAttribute('href'); $mLink.style.display = 'none'; }

        $mPress.textContent = data.press ? ('ì¶œì²˜: ' + data.press) : '';
        showModal();
      }catch(e){
        console.error(e);
        alert('ìƒì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    const list = document.getElementById('news-list');
    list.addEventListener('click', (e)=>{
      const btn = e.target.closest('.more-toggle');
      if (btn) return;
      const card = e.target.closest('.news-card');
      if(!card) return;
      const id = card.getAttribute('data-id');
      if(id) openModalById(id);
    });

    list.addEventListener('keydown', (e)=>{
      if(e.key!=='Enter') return;
      const card = e.target.closest('.news-card');
      if(!card) return;
      const id = card.getAttribute('data-id');
      if(id) openModalById(id);
    });

    list.addEventListener('click', (e)=>{
      const btn = e.target.closest('.more-toggle');
      if (!btn) return;
      e.stopPropagation();
      e.preventDefault();

      const card = btn.closest('.news-card');
      const expanded = card.getAttribute('data-expanded') === 'true';
      card.setAttribute('data-expanded', expanded ? 'false' : 'true');
      btn.textContent = expanded ? 'ë” ë³´ê¸°' : 'ì ‘ê¸°';
    });

    (async function loadBriefing(){
      const wrap = document.querySelector('.briefing-content');
      if(!wrap) return;
      try{
        const res = await fetch('/pages/news/api/briefing/yesterday');
        if(!res.ok){ wrap.innerHTML = '<p class="muted">ì „ì¼ ê¸°ì‚¬ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
        const data = await res.json();
        wrap.innerHTML = '';

        const date = document.createElement('p');
        date.className = 'briefing-date';
        date.textContent = (data.date ? '('+data.date+') ' : '') + 'ì „ì¼ ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½';
        wrap.appendChild(date);

        if(!Array.isArray(data.categories) || data.categories.length===0){
          wrap.innerHTML += '<p class="muted">ì „ì¼ ê¸°ì‚¬ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        for(const cat of data.categories){
          const box = document.createElement('div');
          box.className = 'briefing-box';
          const h5 = document.createElement('h5'); h5.className = 'briefing-title'; h5.textContent = 'ğŸ“Œ ' + (cat.category || 'ë¶„ë¥˜ ì—†ìŒ');
          const p = document.createElement('p');  p.className  = 'briefing-summary'; p.textContent = cat.summary || 'ìš”ì•½ ì—†ìŒ';
          const tags = document.createElement('div'); tags.className = 'briefing-highlights';

          if(Array.isArray(cat.highlights)){
            for(const t of cat.highlights){
              const span = document.createElement('span');
              span.className = 'highlight';
              span.textContent = t;
              tags.appendChild(span);
            }
          }
          box.append(h5,p,tags);
          wrap.appendChild(box);
        }
      }catch(_){
        const w = document.querySelector('.briefing-content');
        if (w) w.innerHTML = '<p class="error">ìš”ì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
      }
    })();
  })();
</script>

<noscript>ì´ í˜ì´ì§€ë¥¼ ë³´ë ¤ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œì„±í™”í•˜ì„¸ìš”.</noscript>
</body>
</html>
