<!-- templates/trends.html â€” "ì†Œë¹„ íŠ¸ë Œë“œ ì˜ˆì¸¡ + í‚¤ì›Œë“œ ì¶”ì´" í†µí•©ë³¸ -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>íŠ¸ëœë“œ ì˜ˆì¸¡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <script th:src="@{/js/app.js}"></script>
  <!-- Chart.js í•œ ë²ˆë§Œ ë¡œë“œ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div th:replace="fragments/header :: siteHeader"></div>

<main class="main">
  <div class="container">
    <div id="trends.html" class="page">
      <h2 class="page-title">ì†Œë¹„ íŠ¸ë Œë“œ ì˜ˆì¸¡</h2>

      <!-- ìƒë‹¨: ì†Œë¹„ ì „ë§ + ìƒê´€ê´€ê³„ -->
      <div class="trends-grid">
        <div class="chart-section">
          <h3>í–¥í›„ 3ê°œì›” ì†Œë¹„ ì „ë§</h3>
          <div class="chart-container" style="position: relative; height: 300px;">
            <canvas id="trendsChart"></canvas>
          </div>
        </div>

        <div class="correlation-section">
          <h3>ê²½ì œì§€í‘œ ìƒê´€ê´€ê³„</h3>
          <div class="correlation-grid">
            <div class="correlation-item high">
              <span class="label">ê¸ˆë¦¬ â†” ë¶€ë™ì‚°</span>
              <span class="value">-0.87</span>
            </div>
            <div class="correlation-item medium">
              <span class="label">í™˜ìœ¨ â†” ìˆ˜ì¶œ</span>
              <span class="value">0.64</span>
            </div>
            <div class="correlation-item low">
              <span class="label">ë¬¼ê°€ â†” ì†Œë¹„</span>
              <span class="value">-0.32</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ì—…ì¢…ë³„ ì¹´ë“œ -->
      <div class="forecast-section">
        <h3>ì—…ì¢…ë³„ ì „ë§</h3>
        <div class="forecast-cards">
          <div class="forecast-card positive">
            <h4>IT/ë°˜ë„ì²´</h4>
            <div class="forecast-trend">ğŸ“ˆ ìƒìŠ¹</div>
            <p>AI ìˆ˜ìš” ì¦ê°€ì™€ ë©”ëª¨ë¦¬ ê°€ê²© íšŒë³µì„¸</p>
          </div>
          <div class="forecast-card neutral">
            <h4>ë¶€ë™ì‚°</h4>
            <div class="forecast-trend">â†’ ë³´í•©</div>
            <p>ê¸ˆë¦¬ ì •ì±…ê³¼ ê·œì œ ì™„í™” ê¸°ëŒ€ê° ìƒì¶©</p>
          </div>
          <div class="forecast-card negative">
            <h4>ë‚´ìˆ˜ì†Œë¹„</h4>
            <div class="forecast-trend">ğŸ“‰ ë‘”í™”</div>
            <p>ê³ ê¸ˆë¦¬ì™€ ë¬¼ê°€ ë¶€ë‹´ ì§€ì†</p>
          </div>
        </div>
      </div>

      <!-- â–¼ ìƒˆë¡œ ì¶”ê°€: ì£¼ìš” í‚¤ì›Œë“œ ì¶”ì´ -->
      <div class="keyword-section" style="margin-top: 28px;">
        <h3>ì£¼ìš” í‚¤ì›Œë“œ ì¶”ì´</h3>
        <div class="chart-container" style="position: relative; height: 360px;">
          <canvas id="keywordChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ìŠ¤í¬ë¦½íŠ¸: ë‘ ì°¨íŠ¸ ì´ˆê¸°í™” -->
<script>
  // -------------------------------------------
  // 1) ì†Œë¹„ ì „ë§(ë°ëª¨ìš©): ê°„ë‹¨í•œ ë¼ì¸/ì˜ì—­ ì°¨íŠ¸
  //    ì‹¤ì œ ê°’ì´ ìˆìœ¼ë©´ ì—¬ê¸°ë¡œ ë°”ì¸ë”©ë§Œ ë°”ê¾¸ì„¸ìš”.
  // -------------------------------------------
  (function initTrendsChart(){
    const ctx = document.getElementById('trendsChart');
    if(!ctx) return;

    // ì…ë¬¸ììš© ë”ë¯¸ ë°ì´í„°
    const labels = ["ì´ë²ˆë‹¬", "ë‹¤ìŒë‹¬", "ë‹¤ë‹¤ìŒë‹¬"];
    const values = [100, 104, 108]; // ì†Œë¹„ì§€ìˆ˜(=100 ê¸°ì¤€)

    new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "ì†Œë¹„ì§€ìˆ˜(=100)",
          data: values,
          fill: true,
          tension: 0.3,
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: false }
        }
      }
    });
  })();

  // -------------------------------------------
  // 2) í‚¤ì›Œë“œ ì¶”ì´: /keywords JSON â†’ ë¼ì¸ì°¨íŠ¸
  //    ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„°ë¡œ í´ë°±
  //    ê¸°ëŒ€ JSON í˜•ì‹:
  //    {
  //      "dates": ["2025-09-20","2025-09-21",...],
  //      "keywords": {
  //         "ê¸ˆë¦¬":[3,5,4,...],
  //         "í™˜ìœ¨":[2,4,5,...],
  //         "ë¶€ë™ì‚°":[1,2,2,...]
  //      }
  //    }
  // -------------------------------------------
  async function fetchKeywords(){
    try{
      const res = await fetch("/keywords");
      if(!res.ok) throw new Error(res.status);
      return await res.json();
    }catch(e){
      // ğŸ” í´ë°±(ë”ë¯¸)
      return {
        dates: ["2025-09-19","2025-09-20","2025-09-21","2025-09-22","2025-09-23","2025-09-24","2025-09-25"],
        keywords: {
          "ê¸ˆë¦¬":[3,4,5,4,6,7,8],
          "í™˜ìœ¨":[2,2,3,3,4,5,4],
          "ë¶€ë™ì‚°":[1,1,2,2,2,3,3]
        }
      };
    }
  }

  (async function initKeywordChart(){
    const el = document.getElementById("keywordChart");
    if(!el) return;

    const data = await fetchKeywords();
    const labels = data.dates || [];

    // ì„œë¡œ ë‹¤ë¥¸ ìƒ‰ìƒ(HSL) ìë™ ìƒì„±
    const datasets = Object.keys(data.keywords || {}).map((kw, i) => ({
      label: kw,
      data: data.keywords[kw],
      borderColor: `hsl(${(i*70)%360} 70% 45%)`,
      backgroundColor: `hsl(${(i*70)%360} 70% 45% / 0.15)`,
      pointRadius: 2,
      fill: false,
      tension: 0.3,
      borderWidth: 2
    }));

    new Chart(el, {
      type: "line",
      data: { labels, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: "top" },
          tooltip: { mode: "index", intersect: false }
        },
        interaction: { mode: "nearest", axis: "x", intersect: false },
        scales: {
          x: { ticks: { maxRotation: 0, autoSkip: true } },
          y: { beginAtZero: true, title: { display: true, text: "ì–¸ê¸‰ëŸ‰(ê±´)" } }
        }
      }
    });
  })();
</script>
</body>
</html>