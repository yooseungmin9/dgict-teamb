<!-- books_min.html : 표지 + 제목/지은이/날짜 만 표시 -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>경제관련 추천 도서</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        .book-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .book-card {
            width: 180px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .book-card img {
            width: 120px;
            height: auto;
            border-radius: 4px;
        }
        .book-title {
            font-weight: bold;
            margin: 10px 0 5px;
        }
        .book-author {
            font-size: 0.9em;
            color: #666;
        }
        .book-date {
            font-size: 0.8em;
            color: #999;
        }
    </style>
</head>
<body>
<h1>경제관련 추천 도서</h1>
<div class="toolbar">
    <button id="btn">조회</button>
    <span id="status"></span>
    <span style="margin-left:auto">총 <b id="count">0</b>권</span>
</div>

<div id="error" class="err" style="display:none;"></div>
<div id="list" class="grid"></div>
<div id="empty" class="empty" style="display:none;">결과가 없습니다.</div>

<script>
    // ----- 환경 설정 -----
    const API_URL = "http://127.0.0.1:8000/books"; // FastAPI 엔드포인트
    // ---------------------

    const elBtn = document.getElementById("btn");
    const elStatus = document.getElementById("status");
    const elErr = document.getElementById("error");
    const elList = document.getElementById("list");
    const elEmpty = document.getElementById("empty");
    const elCount = document.getElementById("count");

    function setLoading(on){ elBtn.disabled = on; elStatus.textContent = on ? "불러오는 중..." : ""; }
    function showErr(msg){ elErr.style.display="block"; elErr.textContent=msg; }
    function clearErr(){ elErr.style.display="none"; elErr.textContent=""; }

    // 카드 렌더링: 표지 + 제목/지은이/날짜
    function render(items){
      elList.innerHTML = "";
      elCount.textContent = String(items.length);
      if(!items.length){ elEmpty.style.display="block"; return; }
      elEmpty.style.display="none";

      for(const it of items){
        const card = document.createElement("div"); card.className="card";

        const img = document.createElement("img");
        img.className="cover"; img.loading="lazy"; img.alt="표지";
        img.src = it.cover || "";
        card.appendChild(img);

        const right = document.createElement("div");

        const title = document.createElement("div"); title.className="title";
        if(it.link){
          const a = document.createElement("a");
          a.href = it.link; a.target="_blank"; a.rel="noopener noreferrer";
          a.textContent = it.title || "(제목 없음)";
          title.appendChild(a);
        }else{
          title.textContent = it.title || "(제목 없음)";
        }
        right.appendChild(title);

        const meta = document.createElement("div"); meta.className="meta";
        meta.appendChild(document.createTextNode(`지은이: ${it.author || "정보 없음"}`));
        meta.appendChild(document.createElement("br"));
        meta.appendChild(document.createTextNode(`날짜: ${it.pubDate || "정보 없음"}`));
        right.appendChild(meta);

        card.appendChild(right);
        elList.appendChild(card);
      }
    }

    async function fetchBooks(){
      clearErr(); setLoading(true);
      try{
        const res = await fetch(API_URL, { headers:{ "Accept":"application/json" } });
        if(!res.ok){
          let msg = `HTTP ${res.status}`;
          try{ const j=await res.json(); if(j?.detail) msg += `: ${j.detail}`; }catch(_){}
          throw new Error(msg);
        }
        const data = await res.json(); // {count, items}
        render(Array.isArray(data.items) ? data.items : []);
      }catch(e){
        showErr(e?.message || "요청 실패");
        render([]);
      }finally{
        setLoading(false);
      }
    }

    // 버튼 클릭으로 조회
    elBtn.addEventListener("click", fetchBooks);

    // 페이지 로드시 자동 1회 조회
    fetchBooks();
</script>
</body>
</html>