<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>경제 수집·키워드</title>
<style>
body{font-family:system-ui,Segoe UI,Malgun Gothic,Apple SD Gothic Neo,sans-serif;margin:24px}
button{padding:8px 12px;margin-right:8px}
table{border-collapse:collapse;margin-top:16px;width:560px}
th,td{border:1px solid #ddd;padding:6px;text-align:left}
#log{margin-top:8px;font-size:13px;color:#333}
img{max-width:100%;height:auto;border:1px solid #eee;margin-top:12px}
</style>
</head>
<body>
<h2>수집·분석</h2>
<div>
  <button id="btnNews">뉴스 수집</button>
  <button id="btnBlog">블로그 수집</button>
  <button id="btnTrends">키워드/워드클라우드</button>
</div>
<div id="log"></div>

<h3>상위 키워드</h3>
<table id="tbl"><thead><tr><th>키워드</th><th>빈도</th></tr></thead><tbody></tbody></table>

<h3>워드클라우드</h3>
<img id="wc" src="/static/wordcloud.png" alt="wordcloud"/>

<script>
async function call(path){
  const r = await fetch(path);
  if(!r.ok) throw new Error("HTTP "+r.status);
  return r.json();
}
const log = (m)=>document.getElementById("log").textContent=m;

document.getElementById("btnNews").onclick = async ()=>{
  log("뉴스 수집 중...");
  try{ const j=await call("/run/news?pages=1"); log("뉴스 upserted: "+j.upserted); }
  catch(e){ log("뉴스 오류: "+e.message); }
};
document.getElementById("btnBlog").onclick = async ()=>{
  log("블로그 수집 중...");
  try{ const j=await call("/run/blog?q=%EA%B2%BD%EC%A0%9C&display=30"); log("블로그 upserted: "+j.upserted); }
  catch(e){ log("블로그 오류: "+e.message); }
};
document.getElementById("btnTrends").onclick = async ()=>{
  log("키워드 계산 중...");
  try{
    const j=await call("/trends?days=7&topk=50");
    const tb=document.querySelector("#tbl tbody"); tb.innerHTML="";
    j.top.forEach(([w,c])=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${w}</td><td>${c}</td>`;
      tb.appendChild(tr);
    });
    document.getElementById("wc").src = j.wordcloud + "?t=" + Date.now();
    log("완료");
  }catch(e){ log("분석 오류: "+e.message); }
};
</script>
</body>
</html>
